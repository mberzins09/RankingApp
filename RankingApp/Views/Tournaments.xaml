<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:model="clr-namespace:RankingApp.Models"
             xmlns:views="clr-namespace:RankingApp.ViewModels"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             x:DataType="views:TournamentViewModel"
             x:Class="RankingApp.Views.Tournaments"
             Title="Tournament"
             Style="{StaticResource PrimaryContentPage}">
    <Grid Style="{StaticResource PrimaryGrid}" RowDefinitions="50, 50, 50, *" ColumnDefinitions="10, 100, *, 100, 100">
        <!-- Row 0 -->
        <ImageButton Grid.Row="0" Grid.Column="1" WidthRequest="50" HeightRequest="50" Style="{StaticResource PrimaryImageButton}"
                     Source="savenoborder.png" x:Name="BtnSaveTournament" Clicked="BtnSave_OnClicked" />
        <Label Grid.Row="0" Grid.Column="2" Grid.ColumnSpan="2" Style="{StaticResource PrimaryLabel}" Text="{Binding OneTournament.PointsDifference}" FontSize="30"/>
        <ImageButton Grid.Row="0" Grid.Column="4" HorizontalOptions="Start" WidthRequest="50" HeightRequest="50" Style="{StaticResource PrimaryImageButton}"
                     Source="plusnoborder.png" x:Name="BtnAddGame" Clicked="BtnAddGame_OnClicked" />
        
        <!-- Row 1 -->
        <Label Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4" Style="{StaticResource PrimaryLabel}" Text="{Binding OneTournament.Name}" FontSize="28"/>
        
        <!-- Row 2 -->
        <HorizontalStackLayout Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" Style="{StaticResource PrimaryHorizontal}">
            <Label Text="{Binding OneTournament.TournamentPlayerName}" Style="{StaticResource PrimaryLabel}" FontSize="20"/>
            <Label Text="{Binding OneTournament.TournamentPlayerSurname}" Style="{StaticResource PrimaryLabel}" FontSize="20"/>
        </HorizontalStackLayout>
        <Label Grid.Row="2" Grid.Column="3" Style="{StaticResource PrimaryLabel}" Text="{Binding OneTournament.Coefficient}" FontSize="18"/>
        <Label Grid.Row="2" Grid.Column="4" Style="{StaticResource PrimaryLabel}" Text="{Binding OneTournament.DateToString}" FontSize="18"/>
        
        <!-- Row 3 -->
        <ListView x:Name="ListViewTournamentGames" ItemsSource="{Binding Games}" Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="4"
                  Style="{StaticResource PrimaryListView}" SelectedItem="{Binding SelectedGame, Mode=TwoWay}">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="model:Game">
                    <ViewCell>
                        <VerticalStackLayout Style="{StaticResource PrimaryVertical}">
                            <Label Text="{Binding OpponentName}" Padding="0" Style="{StaticResource ListItemLabel}" FontSize="16"/>
                            <HorizontalStackLayout Spacing="2" Style="{StaticResource PrimaryHorizontal}">
                                <Label Text="{Binding GameScore}" Style="{StaticResource ListItemLabel}"/>
                                <Label Text="Points change" Style="{StaticResource ListItemLabel}"/>
                                <Label Text="{Binding RatingDifference}" Style="{StaticResource ListItemLabel}"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                        <ViewCell.ContextActions>
                            <MenuItem Text="Delete" IsDestructive="True" 
                                      Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteGameCommand}" 
                                      CommandParameter="{Binding .}"></MenuItem>
                        </ViewCell.ContextActions>
                    </ViewCell>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</ContentPage>